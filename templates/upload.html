{% extends "base.html" %}
{% block title %}Upload{% endblock %}
{% block content %}
<h2 class="mb-3 fw-bold">Upload Photo for ID: <span class="text-secondary">{{ id }}</span></h2>

{% if error %}
    <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<form method="POST" enctype="multipart/form-data" action="{{ url_for('upload', id=id) }}">
    <input type="file" id="fileInput" name="photo" accept="image/*" class="form-control d-none">
    <input type="file" id="cameraInput" name="photo" accept="image/*" capture="environment" class="form-control d-none">

    <div class="d-flex gap-2 mb-3">
        <button type="button" class="btn btn-outline-dark flex-fill" onclick="document.getElementById('fileInput').click()">📁 Choose File</button>
        <button type="button" class="btn btn-outline-secondary flex-fill" onclick="document.getElementById('cameraInput').click()">📷 Take Photo</button>
    </div>

    <div id="previewContainer" class="mt-3 d-none">
        <img id="previewImage" src="#" alt="Image Preview" class="img-fluid border rounded mb-2">
        <button type="button" class="btn btn-sm btn-danger" onclick="clearImage()">❌ Remove</button>
    </div>

    <button type="submit" class="btn btn-success mt-3 w-100 fw-bold">✅ Upload Photo</button>
</form>

<script>
    const fileInput = document.getElementById('fileInput');
    const cameraInput = document.getElementById('cameraInput');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');

    function handleImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewContainer.classList.remove('d-none');
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    fileInput.onchange = () => handleImage(fileInput);
    cameraInput.onchange = () => handleImage(cameraInput);

    function clearImage() {
        fileInput.value = "";
        cameraInput.value = "";
        previewImage.src = "#";
        previewContainer.classList.add('d-none');
    }
</script>
{% endblock %}
